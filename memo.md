memo

# やることメモ

## 開発進捗レポート

### 2021.12.25

#### 実装完了機能(feature/impl)

- UserDoc オブジェクト（firestore 上のユーザーアカウントデータのオブジェクトのこと）に locationObject を持たせ、マイページから任意で現在地を設定する
- ShowFoundUsersList で表示される近くの友達の判定基準に、location 同士を比較した距離が一定以内かどうかを追加（とりあえず 10km 以内なら表示されるようにしてます）
- 友達削除機能を実装：とりあえず開発向けの簡易的なもの。それに伴い、ShowChatRoom コンポーネント内にチャットルームメニューを実装（Header の右端の Menu で見れる）
  > ついでなのでトーク相手のプロフィールなども見れるようにしてみた

#### 変更点(rearch)

- UserDoc オブジェクトの request を map 構造化、それに伴い全体的なコード修正
- App.js allUserDocsState について、useEffect 内にて自動更新を設定
- UI/UserProfile コンポーネントを追加、FindUsers/ShowUserProfile, Friend/ShowUserProfile, ShowChatRoom 内で使用

#### 発見したバグ

- 登録してすぐのフレンドのチャットルームを、アプリの再起動や再ログインなしで開こうとするとエラーになる

  > 新しくフレンド登録が実行された時、ChatRoomDataState を変更するコードを追加すればよい

- ユーザーを探す >> リクエストを送る を多重クリックすると、フレンドリスト内に渡されるデータが不正な値になるっぽい（エラー経験済み）
  > とりあえず、ダブルクリック以上できないようにモーダルを表示。もう少し詳しく調査する必要があるが、基本的に DB との通信関数は連続で呼び出してはならないので、その辺を調整

#### 12/26 の開発予定

- 全体的なスタイル調整と、scss ファイル群の最適化
- App.js コンポーネントをさらに階層化し、Auth.js >> App.js >> Handlers という構造へ変更する
  > App.js の実装が肥大化してきたので、Auth 処理は別コンポーネントの State で持ちたい
- モーダルを App ではなく Handler 階層のコンポーネントで保持する構造へ変更
  > ナビゲーション実装のための調整
- /fn/db/ディレクトリのファイルを整理する
- 発見したバグの修正
- firebase hosting の設定
- ユーザーナビゲーションの実装開始

## 優先度 ★★★★★ : updated at 2021.12.26

### 友達初登録時、チャット画面を開くとエラーが出る現象の修正

- onSnapShot を別途登録する必要があるところを、登録処理を挟んでいないのが原因
- registerOnSnapshot を作るか

### 決済機能の追加

- 決済機能部分を作成したい
- 試験運用版にはつけないほうがいいかも...という気がする。製品の品質が保証できてないのに金取れないと思う

### ルーティングしたい

- 一応、スワイプでの戻る操作とかに対応したいので、ルーティングしたい
- react-router の使用を検討

### パフォーマンスチューニングとコードのメンテナンス性アップ

- 現状、基本的に state と Memo しか使っていないので、適宜 useCallback、state の最適化などを施す
- 特に authState 周りは、App コンポーネントのラッパーコンポーネントを作成してそこで管理したほうがいいかもしれない
- Menu コンポーネントを一時的に非表示にする機能が欲しい：chat コンポーネントなど特定コンポーネントで表示したくない
- firebase.handler と App.js で firestore 周りの functions がばらけているので、統一するかいっそ App コンポーネント内に保存してしまうか考えたい

* redux, context の使用を検討
* state >> reducer への置き換えを検討

### エラーハンドリング

- デバッグに手が回ってませんので、エラー多発。
- エラーが発生したら、ログを firebase 上に記録し、モーダル上に視覚的に表示するなど

### 通知機能の実装

- バッチを表示する機能、通知状態を表示する機能
- チャット機能、リクエスト送受信機能等、FriendList 周りだけで良いと思う

### スタイルの調整

- 全体的にスタイルが適当なので、調整する

### firebase hosting によるサーバー上でのテスト運用

- deploy 失敗してるよね？ということで build 周りの調整を行う

## 優先度 ★★★★☆

### PWA 化の実験

- 優先度 Max がすべて終わったら PWA 化を行う
- cloud messaging 等を用いて、スマホ・PC 本体への通知機能を実装

### 視覚的なナビの実装

- 各操作完了後、特定条件下などで、ユーザーの行動をサポートするモーダルを表示
- モーダル機構自体は既に実装しているので、特定状況で表示するコードを追加する

## 優先度 ★★★☆☆

### エラーログの自動記録機能
